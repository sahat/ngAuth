angular.module("satellizer",[]).config(["$httpProvider","$authProvider","satellizer.config",function(e,t,n){e.interceptors.push(["$q",function(e){var t=n.tokenPrefix?n.tokenPrefix+"_"+n.tokenName:n.tokenName;return{request:function(e){var r=localStorage.getItem(t);return r&&(r="Authorization"===n.authHeader?"Bearer "+r:r,e.headers[n.authHeader]=r),e},responseError:function(t){return e.reject(t)}}}])}]),angular.module("satellizer").provider("$auth",["satellizer.config",function(e){Object.defineProperties(this,{logoutRedirect:{get:function(){return e.logoutRedirect},set:function(t){e.logoutRedirect=t}},loginRedirect:{set:function(t){e.loginRedirect=t},get:function(){return e.loginRedirect}},signupRedirect:{get:function(){return e.signupRedirect},set:function(t){e.signupRedirect=t}},loginOnSignup:{get:function(){return e.loginOnSignup},set:function(t){e.loginOnSignup=t}},immediateRedirect:{get:function(){return e.immediateRedirect},set:function(t){e.immediateRedirect=t}},loginUrl:{get:function(){return e.loginUrl},set:function(t){e.loginUrl=t}},signupUrl:{get:function(){return e.signupUrl},set:function(t){e.signupUrl=t}},loginRoute:{get:function(){return e.loginRoute},set:function(t){e.loginRoute=t}},signupRoute:{get:function(){return e.signupRoute},set:function(t){e.signupRoute=t}},tokenName:{get:function(){return e.tokenName},set:function(t){e.tokenName=t}},tokenPrefix:{get:function(){return e.tokenPrefix},set:function(t){e.tokenPrefix=t}},unlinkUrl:{get:function(){return e.unlinkUrl},set:function(t){e.unlinkUrl=t}},authHeader:{get:function(){return e.authHeader},set:function(t){e.authHeader=t}}}),angular.forEach(Object.keys(e.providers),function(t){this[t]=function(n){return angular.extend(e.providers[t],n)}},this);var t=function(t){e.providers[t.name]=e.providers[t.name]||{},angular.extend(e.providers[t.name],t)};this.oauth1=function(n){t(n),e.providers[n.name].type="1.0"},this.oauth2=function(n){t(n),e.providers[n.name].type="2.0"},this.$get=["$q","satellizer.shared","satellizer.local","satellizer.oauth",function(e,t,n,r){var o={};return o.authenticate=function(e,t,n){return r.authenticate(e,!1,t,n)},o.login=function(e){return n.login(e)},o.signup=function(e){return n.signup(e)},o.logout=function(){return t.logout()},o.isAuthenticated=function(){return t.isAuthenticated()},o.link=function(e,t,n){return r.authenticate(e,!0,t,n)},o.unlink=function(e){return r.unlink(e)},o.getToken=function(){return t.getToken()},o.getPayload=function(){return t.getPayload()},o}]}]),function(){function e(e){this.message=e}var t="undefined"!=typeof exports?exports:this,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e.prototype=new Error,e.prototype.name="InvalidCharacterError",t.btoa||(t.btoa=function(t){for(var r,o,i=String(t),a=0,u=n,l="";i.charAt(0|a)||(u="=",a%1);l+=u.charAt(63&r>>8-a%1*8)){if(o=i.charCodeAt(a+=.75),o>255)throw new e("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");r=r<<8|o}return l}),t.atob||(t.atob=function(t){var r=String(t).replace(/=+$/,"");if(r.length%4==1)throw new e("'atob' failed: The string to be decoded is not correctly encoded.");for(var o,i,a=0,u=0,l="";i=r.charAt(u++);~i&&(o=a%4?64*o+i:i,a++%4)?l+=String.fromCharCode(255&o>>(-2*a&6)):0)i=n.indexOf(i);return l})}(),angular.module("satellizer").constant("satellizer.config",{loginOnSignup:!0,loginRedirect:"/",logoutRedirect:"/",signupRedirect:"/login",immediateRedirect:"/auth/immediate",loginUrl:"/auth/login",signupUrl:"/auth/signup",loginRoute:"/login",signupRoute:"/signup",tokenName:"token",tokenPrefix:"satellizer",unlinkUrl:"/auth/unlink/",authHeader:"Authorization",providers:{google:{url:"/auth/google",authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",redirectUri:window.location.origin||window.location.protocol+"//"+window.location.host,scope:["profile","email"],scopePrefix:"openid",scopeDelimiter:" ",requiredUrlParams:["scope"],optionalUrlParams:["display"],display:"popup",type:"2.0",popupOptions:{width:452,height:633}},facebook:{url:"/auth/facebook",authorizationEndpoint:"https://www.facebook.com/dialog/oauth",redirectUri:window.location.origin+"/"||window.location.protocol+"//"+window.location.host+"/",scope:["email"],scopeDelimiter:",",requiredUrlParams:["display","scope"],display:"popup",type:"2.0",popupOptions:{width:481,height:269}},linkedin:{url:"/auth/linkedin",authorizationEndpoint:"https://www.linkedin.com/uas/oauth2/authorization",redirectUri:window.location.origin||window.location.protocol+"//"+window.location.host,requiredUrlParams:["state"],scope:["r_emailaddress"],scopeDelimiter:" ",state:"STATE",type:"2.0",popupOptions:{width:527,height:582}},github:{url:"/auth/github",authorizationEndpoint:"https://github.com/login/oauth/authorize",redirectUri:window.location.origin||window.location.protocol+"//"+window.location.host,scope:[],scopeDelimiter:" ",type:"2.0",popupOptions:{width:1020,height:618}},yahoo:{url:"/auth/yahoo",authorizationEndpoint:"https://api.login.yahoo.com/oauth2/request_auth",redirectUri:window.location.origin||window.location.protocol+"//"+window.location.host,scope:[],scopeDelimiter:",",type:"2.0",popupOptions:{width:559,height:519}},twitter:{url:"/auth/twitter",type:"1.0",popupOptions:{width:495,height:645}}}}),angular.module("satellizer").factory("satellizer.iframe",["$q","$window","satellizer.utils",function(e,t,n){return{open:function(r){var o=t.document.createElement("iframe");o.hidden=!0,o.src=r,o.addEventListener("load",function(){t.document.body.removeChild(o),i.reject({error:"unable to load immediate auth redirect"})});var i=e.defer();return t.__immediateAuth=function(e){t.document.body.removeChild(o),delete t.__immediateAuth;var r=n.parseLocationString(e);r.error?i.reject({error:r.error}):i.resolve(r)},t.document.body.appendChild(o),i.promise}}}]),angular.module("satellizer").factory("satellizer.local",["$q","$http","$location","satellizer.utils","satellizer.shared","satellizer.config",function(e,t,n,r,o,i){var a={};return a.login=function(e){return t.post(i.loginUrl,e).then(function(e){return o.setToken(e),e})},a.signup=function(e){return t.post(i.signupUrl,e).then(function(e){return i.loginOnSignup?o.setToken(e):n.path(i.signupRedirect),e})},a}]),angular.module("satellizer").factory("satellizer.oauth",["$q","$http","satellizer.config","satellizer.shared","satellizer.Oauth1","satellizer.Oauth2",function(e,t,n,r,o,i){var a={};return a.authenticate=function(e,t,a,u){var l="1.0"===n.providers[e].type?new o:new i;return l.open(n.providers[e],a||{},u).then(function(e){return r.setToken(e,t),e})},a.unlink=function(e){return t.get(n.unlinkUrl+e)},a}]),angular.module("satellizer").factory("satellizer.Oauth1",["$q","$http","satellizer.popup",function(e,t,n){return function(){var r={url:null,name:null,popupOptions:null},o={};return o.open=function(t,i,a){return a?e.reject("OAuth1 does not support immediate authorization"):(angular.extend(r,t),n.open(r.url,r.popupOptions).then(function(e){return o.exchangeForToken(e,i)}))},o.exchangeForToken=function(e,n){var i=angular.extend({},n,e),a=o.buildQueryString(i);return t.get(r.url+"?"+a)},o.buildQueryString=function(e){var t=[];return angular.forEach(e,function(e,n){t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}),t.join("&")},o}}]),angular.module("satellizer").factory("satellizer.Oauth2",["$q","$http","satellizer.popup","satellizer.iframe","satellizer.utils","satellizer.config",function(e,t,n,r,o,i){return function(){var e,a={url:null,name:null,scope:null,scopeDelimiter:null,clientId:null,redirectUri:null,popupOptions:null,authorizationEndpoint:null,requiredUrlParams:null,optionalUrlParams:null,defaultUrlParams:["response_type","client_id","redirect_uri"],responseType:"code"},u={};return u.open=function(t,o,l){angular.extend(e={},a,t),l&&(delete e.display,e.prompt="none",e.redirectUri=(window.location.origin||window.location.protocol+"//"+window.location.host)+i.immediateRedirect,e.defaultUrlParams.push("prompt"));var c,s=u.buildUrl(l);return c=l?r.open(s):n.open(s,e.popupOptions),c.then(function(t){return"token"===e.responseType?t:u.exchangeForToken(t,o)})},u.exchangeForToken=function(n,r){var o=angular.extend({},r,{code:n.code,clientId:e.clientId,redirectUri:e.redirectUri});return t.post(e.url,o)},u.buildUrl=function(t){var n=e.authorizationEndpoint,r=u.buildQueryString(t);return n+"?"+r},u.buildQueryString=function(){var t=[],n=["defaultUrlParams","requiredUrlParams","optionalUrlParams"];return angular.forEach(n,function(n){angular.forEach(e[n],function(n){var r=o.camelCase(n),i=e[r];"scope"===n&&Array.isArray(i)&&(i=i.join(e.scopeDelimiter),e.scopePrefix&&(i=[e.scopePrefix,i].join(e.scopeDelimiter))),"undefined"!=typeof i&&t.push([n,i])})}),t.map(function(e){return e.join("=")}).join("&")},u}}]),angular.module("satellizer").factory("satellizer.popup",["$q","$interval","$window","$location","satellizer.utils",function(e,t,n,r,o){var i=null,a=null,u={};return u.popupWindow=i,u.open=function(e,t){var n=u.stringifyOptions(u.prepareOptions(t||{}));return i=window.open(e,"_blank",n),i&&i.focus&&i.focus(),u.pollPopup()},u.pollPopup=function(){var n=e.defer();return a=t(function(){try{if(i.document.domain===document.domain&&(i.location.search||i.location.hash)){var e=o.parseLocationString(i.location);e.error?n.reject({error:e.error}):n.resolve(e),i.close(),t.cancel(a)}}catch(r){}i.closed&&(t.cancel(a),n.reject({data:"Authorization Failed"}))},35),n.promise},u.prepareOptions=function(e){var t=e.width||500,r=e.height||500;return angular.extend({width:t,height:r,left:n.screenX+(n.outerWidth-t)/2,top:n.screenY+(n.outerHeight-r)/2.5},e)},u.stringifyOptions=function(e){var t=[];return angular.forEach(e,function(e,n){t.push(n+"="+e)}),t.join(",")},u}]),angular.module("satellizer").factory("satellizer.shared",["$q","$window","$location","satellizer.config",function(e,t,n,r){var o={};return o.getToken=function(){var e=r.tokenPrefix?r.tokenPrefix+"_"+r.tokenName:r.tokenName;return t.localStorage[e]},o.getPayload=function(){var e=r.tokenPrefix?r.tokenPrefix+"_"+r.tokenName:r.tokenName,n=t.localStorage[e];if(n&&3===n.split(".").length){var o=n.split(".")[1],i=o.replace("-","+").replace("_","/");return JSON.parse(t.atob(i))}},o.setToken=function(e,o){var i=e.access_token||e.data[r.tokenName],a=r.tokenPrefix?r.tokenPrefix+"_"+r.tokenName:r.tokenName;if(!i)throw new Error('Expecting a token named "'+r.tokenName+'" but instead got: '+JSON.stringify(e.data));t.localStorage[a]=i,r.loginRedirect&&!o&&n.path(r.loginRedirect)},o.isAuthenticated=function(){var e=r.tokenPrefix?r.tokenPrefix+"_"+r.tokenName:r.tokenName,n=t.localStorage[e];if(n){if(3===n.split(".").length){var o=n.split(".")[1],i=o.replace("-","+").replace("_","/"),a=JSON.parse(t.atob(i)).exp;return Math.round((new Date).getTime()/1e3)<=a}return!0}return!1},o.logout=function(){var o=r.tokenPrefix?r.tokenPrefix+"_"+r.tokenName:r.tokenName;return delete t.localStorage[o],r.logoutRedirect&&n.path(r.logoutRedirect),e.when()},o}]),angular.module("satellizer").service("satellizer.utils",function(){this.camelCase=function(e){return e.replace(/([\:\-\_]+(.))/g,function(e,t,n,r){return r?n.toUpperCase():n})},this.parseQueryString=function(e){var t,n,r={};return angular.forEach((e||"").split("&"),function(e){e&&(n=e.split("="),t=decodeURIComponent(n[0]),r[t]=angular.isDefined(n[1])?decodeURIComponent(n[1]):!0)}),r},this.parseLocationString=function(e){var t=e.search.substring(1).replace(/\/$/,""),n=e.hash.substring(1).replace(/\/$/,""),r=this.parseQueryString(n),o=this.parseQueryString(t);return angular.extend(o,r),o}});