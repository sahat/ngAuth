!function(e,t){"use strict";function n(){this.config=f,this.providers=h,this.facebook=function(e){t.extend(h.facebook,e)},this.google=function(e){t.extend(h.google,e)},this.linkedin=function(e){t.extend(h.linkedin,e)},this.twitter=function(e){t.extend(h.twitter,e)},this.oauthBase=function(e){h[e.name]=h[e.name]||{},t.extend(h[e.name],e)},this.oauth1=function(e){this.oauthBase(e),h[e.name].type="1.0"},this.oauth2=function(e){this.oauthBase(e),h[e.name].type="2.0"},this.$get=function(e,t,n,o,r){var i={};return i.authenticate=function(t){var i=e.defer(),u="1.0"===h[t].type?n:o;return u.open(h[t]).then(function(e){r.parseUser(e.token,i)}),i.promise},i.login=function(e){r.login(e)},i.signup=function(e){r.signup(e)},i.logout=function(){r.logout()},i.isAuthenticated=function(){r.isAuthenticated()},i}}function o(e,t,n,o,r,i){var u={};return u.parseUser=function(e,t){var u=JSON.parse(n.atob(e.split(".")[1]));i.set(f.tokenKey,e),o[f.user]=u.user,r.path(f.loginRedirect),t.resolve(u.user)},u.login=function(n){var o=e.defer();return t.post(f.loginUrl,n).success(function(e){u.parseUser(e.token,o)}).error(function(e){o.reject(e)}),o.promise},u.signup=function(e){t.post(f.signupUrl,e).then(function(){r.path(f.signupRedirect)})},u.logout=function(){delete o[f.user],i.remove(f.tokenKey),r.path(f.logoutRedirect)},u.isAuthenticated=function(){return Boolean(o[f.user])},u}function r(e,n,o){var r=null,i=null,u={};return u.popupWindow=r,u.open=function(t,n){var i=e.defer(),a=u.stringifyOptions(u.prepareOptions(n||{}));return r=o.open(t,"Satellizer",a),r.focus(),u.postMessageHandler(i),u.pollPopup(i),i.promise},u.pollPopup=function(e){i=n(function(){r.closed&&(n.cancel(i),e.reject("Popup was closed by the user"))},35)},u.postMessageHandler=function(e){o.addEventListener("message",function(t){t.origin===o.location.origin&&e.resolve(t.data)},!1)},u.prepareOptions=function(e){var n=e.width||500,r=e.height||500;return t.extend({width:n,height:r,left:o.screenX+(o.outerWidth-n)/2,top:o.screenY+(o.outerHeight-r)/2.5},e)},u.stringifyOptions=function(e){var n=[];return t.forEach(e,function(e,t){n.push(t+"="+e)}),n.join(",")},u}function i(e,n,o){var r={url:null,name:null,popupOptions:null},i={};return i.open=function(n){t.extend(r,n);var u=e.defer();return o.open(r.url).then(function(e){i.exchangeForToken(e).then(function(e){u.resolve(e.data)})}),u.promise},i.exchangeForToken=function(e){return e=i.buildQueryString(e),n.get(r.url+"?"+e)},i.buildQueryString=function(e){var n=[];return t.forEach(e,function(e,t){n.push(encodeURIComponent(t)+"="+encodeURIComponent(e))}),n.join("&")},i}function u(e,n,o,r){var i={url:null,name:null,scope:null,scopeDelimiter:null,clientId:null,redirectUri:null,popupOptions:null,authorizationEndpoint:null,requiredUrlParams:null,optionalUrlParams:null,defaultUrlParams:["response_type","client_id","redirect_uri"],responseType:"code"},u={};return u.open=function(n){t.extend(i,n);var o=e.defer(),a=u.buildUrl();return r.open(a,i.popupOptions).then(function(e){u.exchangeForToken(e).then(function(e){o.resolve(e.data)})}),o.promise},u.exchangeForToken=function(e){return n.post(i.url,{code:e.code,clientId:i.clientId,redirectUri:i.redirectUri})},u.buildUrl=function(){var e=i.authorizationEndpoint,t=u.buildQueryString();return[e,t].join("?")},u.buildQueryString=function(){var e=[],n=["defaultUrlParams","requiredUrlParams","optionalUrlParams"];return t.forEach(n,function(n){t.forEach(i[n],function(t){var n=o.camelCase(t),r=i[n];e.push([t,encodeURIComponent(r)])})}),e.map(function(e){return e.join("=")}).join("&")},u}function a(e,t,n){return{request:function(e){return n.get(f.tokenKey)&&(e.headers.Authorization="Bearer "+n.get(f.tokenKey)),e},responseError:function(o){return(401===o.status||403===o.status)&&(n.remove(f.tokenKey),t.path("/login")),e.reject(o)}}}function c(e){e.setPrefix(f.tokenPrefix)}function s(e){e.interceptors.push("HttpInterceptor")}function l(e){e.run()}function p(e,t,n,o,r){return{run:function(){var i=o.get(f.tokenKey);if(i){var u=JSON.parse(t.atob(i.split(".")[1]));e[f.user]=u.user}var a=t.location.search.substring(1),c=Object.keys(n.search()).length?n.search():r.parseQueryString(a);t.opener&&t.opener.location.origin===t.location.origin&&(c.oauth_token&&c.oauth_verifier?t.opener.postMessage({oauth_token:c.oauth_token,oauth_verifier:c.oauth_verifier},"*"):c.code&&t.opener.postMessage({code:c.code},"*"),t.close())}}}function d(){this.camelCase=function(e){return e.replace(/([\:\-\_]+(.))/g,function(e,t,n,o){return o?n.toUpperCase():n})},this.parseQueryString=function(e){var n,o,r={};return t.forEach((e||"").split("&"),function(e){e&&(o=e.split("="),n=decodeURIComponent(o[0]),r[n]=t.isDefined(o[1])?decodeURIComponent(o[1]):!0)}),r}}t.module("Satellizer",["LocalStorageModule"]).provider("$auth",n).factory("RunBlock",p).factory("Local",o).factory("Oauth2",u).factory("Oauth1",i).factory("Popup",r).factory("HttpInterceptor",a).service("Utils",d).config(c).config(s).run(l);var f={logoutRedirect:"/",loginRedirect:"/",loginUrl:"/auth/login",signupUrl:"/auth/signup",signupRedirect:"/login",loginRoute:"/login",signupRoute:"/signup",user:"currentUser",tokenPrefix:"satellizer",tokenKey:"jwtToken"},h={google:{url:"/auth/google",authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",redirectUri:e.location.origin,scope:"openid profile email",scopeDelimiter:" ",requiredUrlParams:["scope"],optionalUrlParams:["display"],display:"popup",type:"2.0",popupOptions:{width:452,height:633}},facebook:{url:"/auth/facebook",authorizationEndpoint:"https://www.facebook.com/dialog/oauth",redirectUri:e.location.origin+"/",scope:"email",scopeDelimiter:",",requiredUrlParams:["display"],display:"popup",type:"2.0",popupOptions:{width:481,height:269}},linkedin:{url:"/auth/linkedin",authorizationEndpoint:"https://www.linkedin.com/uas/oauth2/authorization",redirectUri:e.location.origin,requiredUrlParams:["state"],scope:[],scopeDelimiter:" ",state:"STATE",type:"2.0",popupOptions:{width:527,height:582}},twitter:{url:"/auth/twitter",type:"1.0"}};o.$inject=["$q","$http","$window","$rootScope","$location","localStorageService"],r.$inject=["$q","$interval","$window"],i.$inject=["$q","$http","Popup"],u.$inject=["$q","$http","Utils","Popup"],a.$inject=["$q","$location","localStorageService"],c.$inject=["localStorageServiceProvider"],s.$inject=["$httpProvider"],l.$inject=["RunBlock"],p.$inject=["$rootScope","$window","$location","localStorageService","Utils"]}(window,window.angular);